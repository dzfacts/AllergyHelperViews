<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Select 2 Test</title>
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <link href="http://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2/css/select2.css" rel="stylesheet" />
    <script src="http://code.jquery.com/jquery-1.12.2.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2/js/select2.js"></script>
    <script type="text/javascript">
    $(function() {
        var $tags = $(".js-example-tags");
        $tags.select2({
            ajax: {
                data: function(params) {
                    var unicode = "\uf8ff";
                    var query = {
                        orderBy: "\"lowerCaseName\"",
                        startAt: '"' + params.term + '"'.toLowerCase(),
                        endAt: '"' + params.term + unicode + '"'.toLowerCase(),
                        print: "\"pretty\""
                    };
                    // Query paramters will be ?search=[term]&page=[page]
                    return query;
                },
                url: 'https://allergyhelper3.firebaseio.com/substancies.json?',
                processResults: function(data, key) {
                    return {
                        results: $.map(data, function(obj, key) {
                            return {
                                id: key,
                                text: obj.lowerCaseName
                            };
                        })
                    };
                }
            },
            tags: true,
            matcher: function(params, data) {
                // If there are no search terms, return all of the data
                if ($.trim(params.term) === '') {
                    return data;
                }

                // `params.term` should be the term that is used for searching
                // `data.text` is the text that is displayed for the data object
                if (data.text.toLowerCase().indexOf(params.term.toLowerCase()) > -1) {
                    return data;
                }

                // Return `null` if the term should not be displayed
                return null;
            },
            createTag: function(params) {
                var term = $.trim(params.term);
                if (term === "") {
                    return null;
                }

                var optionsMatch = false;

                this.$element.find("option").each(function() {
                    if (this.value.toLowerCase().indexOf(term.toLowerCase()) > -1) {
                        optionsMatch = true;
                    }
                });

                if (optionsMatch) {
                    return null;
                }
                return {
                    id: term,
                    text: term
                };
            },
            minimumInputLength: 3,
            tokenSeparators: [','],
            casesensitive: false
        });
    });
    </script>
</head>

<body>
    <h1 id="tags">Tagging support</h1>
    <p>
        Select2 can be used to quickly set up fields used for tagging.
    </p>
    <p>
        Note that when tagging is enabled the user can select from pre-existing options or create a new tag by picking the first choice, which is what the user has typed into the search box so far.</p>
    <p>
        <select class="js-example-tags form-control" multiple="multiple"></select>
    </p>
</body>

</html>